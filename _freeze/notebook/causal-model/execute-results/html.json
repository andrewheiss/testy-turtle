{
  "hash": "b1e4aa8a76cf4c71b022a647f7d3cc4e",
  "result": {
    "markdown": "---\ntitle: \"DAGs and adjustment sets\"\nauthor: \"Suparna Chaudhry and Andrew Heiss\"\ndate: 2022-11-15\ndate-modified: \"2023-01-19\"\neditor_options: \n  chunk_output_type: console\n---\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(targets)\nlibrary(ggdag)\nlibrary(dagitty)\nlibrary(here)\n\ninvisible(list2env(tar_read(graphic_functions), .GlobalEnv))\ninvisible(list2env(tar_read(misc_funs), .GlobalEnv))\n\nupdate_geom_defaults(ggdag:::GeomDagText, list(family = \"Noto Sans\", face = \"plain\"))\n\nmy_seed <- 1234\nset.seed(my_seed)\n```\n:::\n\n\n\n# Full messy model\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nhuge_messy_dag <- dagitty('\ndag {\n\"Corruption[t-1]\" [adjusted,pos=\"7.000,2.000\"]\n\"Corruption[t-i]\" [pos=\"2.000,2.000\"]\n\"Corruption[t]\" [pos=\"12.000,2.000\"]\n\"Democracy[t-1]\" [adjusted,pos=\"7.250,1.000\"]\n\"Democracy[t-i]\" [pos=\"2.250,1.000\"]\n\"Democracy[t]\" [pos=\"12.250,1.000\"]\n\"Disasters[t-1]\" [adjusted,pos=\"7.250,12.000\"]\n\"Disasters[t-i]\" [pos=\"2.250,12.000\"]\n\"Disasters[t]\" [pos=\"12.250,12.000\"]\n\"Education[t-1]\" [adjusted,pos=\"6.250,8.000\"]\n\"Education[t-i]\" [pos=\"1.250,8.000\"]\n\"Education[t]\" [pos=\"11.250,8.000\"]\n\"GDP/capita[t-1]\" [adjusted,pos=\"6.000,6.000\"]\n\"GDP/capita[t-i]\" [pos=\"1.000,6.000\"]\n\"GDP/capita[t]\" [pos=\"11.000,6.000\"]\n\"Health[t-1]\" [adjusted,pos=\"6.500,9.000\"]\n\"Health[t-i]\" [pos=\"1.500,9.000\"]\n\"Health[t]\" [pos=\"11.500,9.000\"]\n\"Mortality[t-1]\" [adjusted,pos=\"6.750,10.000\"]\n\"Mortality[t-i]\" [pos=\"1.750,10.000\"]\n\"Mortality[t]\" [pos=\"11.750,10.000\"]\n\"Outcome[t-1]\" [pos=\"9.000,6.500\"]\n\"Outcome[t-i]\" [pos=\"4.000,6.500\"]\n\"Outcome[t]\" [outcome,pos=\"14.000,6.500\"]\n\"Restrictions[t-1]\" [exposure,pos=\"8.000,7.750\"]\n\"Restrictions[t-i]\" [adjusted,pos=\"3.000,7.750\"]\n\"Restrictions[t]\" [pos=\"13.000,7.750\"]\n\"Trade[t-1]\" [adjusted,pos=\"6.000,7.000\"]\n\"Trade[t-i]\" [pos=\"1.000,7.000\"]\n\"Trade[t]\" [pos=\"11.000,7.000\"]\n\"Violence[t-1]\" [adjusted,pos=\"6.250,5.000\"]\n\"Violence[t-i]\" [pos=\"1.250,5.000\"]\n\"Violence[t]\" [pos=\"11.250,5.000\"]\n\"`Civil liberties`[t-1]\" [adjusted,pos=\"6.500,4.000\"]\n\"`Civil liberties`[t-i]\" [pos=\"1.500,4.000\"]\n\"`Civil liberties`[t]\" [pos=\"11.500,4.000\"]\n\"`Internal conflict`[t-1]\" [adjusted,pos=\"7.000,11.000\"]\n\"`Internal conflict`[t-i]\" [pos=\"2.000,11.000\"]\n\"`Internal conflict`[t]\" [pos=\"12.000,11.000\"]\n\"`Rule of law`[t-1]\" [adjusted,pos=\"6.750,3.000\"]\n\"`Rule of law`[t-i]\" [pos=\"1.750,3.000\"]\n\"`Rule of law`[t]\" [pos=\"11.750,3.000\"]\n\"Corruption[t-1]\" -> \"Corruption[t]\"\n\"Corruption[t-1]\" -> \"Outcome[t-1]\"\n\"Corruption[t-1]\" -> \"Restrictions[t-1]\"\n\"Corruption[t-i]\" -> \"Corruption[t-1]\"\n\"Corruption[t-i]\" -> \"Outcome[t-i]\"\n\"Corruption[t-i]\" -> \"Restrictions[t-i]\"\n\"Corruption[t]\" -> \"Outcome[t]\"\n\"Corruption[t]\" -> \"Restrictions[t]\"\n\"Democracy[t-1]\" -> \"Corruption[t-1]\"\n\"Democracy[t-1]\" -> \"Democracy[t]\"\n\"Democracy[t-1]\" -> \"Outcome[t-1]\"\n\"Democracy[t-1]\" -> \"Restrictions[t-1]\"\n\"Democracy[t-1]\" -> \"`Rule of law`[t-1]\"\n\"Democracy[t-i]\" -> \"Democracy[t-1]\"\n\"Democracy[t-i]\" -> \"Outcome[t-i]\"\n\"Democracy[t-i]\" -> \"Restrictions[t-i]\"\n\"Democracy[t]\" -> \"Corruption[t]\"\n\"Democracy[t]\" -> \"Outcome[t]\"\n\"Democracy[t]\" -> \"Restrictions[t]\"\n\"Democracy[t]\" -> \"`Rule of law`[t]\"\n\"Disasters[t-1]\" -> \"Outcome[t-1]\"\n\"Disasters[t-1]\" -> \"Restrictions[t-1]\"\n\"Disasters[t-i]\" -> \"Outcome[t-i]\"\n\"Disasters[t-i]\" -> \"Restrictions[t-i]\"\n\"Disasters[t]\" -> \"Outcome[t]\"\n\"Disasters[t]\" -> \"Restrictions[t]\"\n\"Education[t-1]\" -> \"Education[t]\"\n\"Education[t-1]\" -> \"Outcome[t-1]\"\n\"Education[t-1]\" -> \"Restrictions[t-1]\"\n\"Education[t-i]\" -> \"Education[t-1]\"\n\"Education[t-i]\" -> \"Outcome[t-i]\"\n\"Education[t-i]\" -> \"Restrictions[t-i]\"\n\"Education[t]\" -> \"Outcome[t]\"\n\"Education[t]\" -> \"Restrictions[t]\"\n\"GDP/capita[t-1]\" -> \"GDP/capita[t]\"\n\"GDP/capita[t-1]\" -> \"Outcome[t-1]\"\n\"GDP/capita[t-1]\" -> \"Restrictions[t-1]\"\n\"GDP/capita[t-i]\" -> \"GDP/capita[t-1]\"\n\"GDP/capita[t-i]\" -> \"Outcome[t-i]\"\n\"GDP/capita[t-i]\" -> \"Restrictions[t-i]\"\n\"GDP/capita[t]\" -> \"Outcome[t]\"\n\"GDP/capita[t]\" -> \"Restrictions[t]\"\n\"Health[t-1]\" -> \"Health[t]\"\n\"Health[t-1]\" -> \"Outcome[t-1]\"\n\"Health[t-1]\" -> \"Restrictions[t-1]\"\n\"Health[t-i]\" -> \"Health[t-1]\"\n\"Health[t-i]\" -> \"Outcome[t-i]\"\n\"Health[t-i]\" -> \"Restrictions[t-i]\"\n\"Health[t]\" -> \"Outcome[t]\"\n\"Health[t]\" -> \"Restrictions[t]\"\n\"Mortality[t-1]\" -> \"Mortality[t]\"\n\"Mortality[t-1]\" -> \"Outcome[t-1]\"\n\"Mortality[t-1]\" -> \"Restrictions[t-1]\"\n\"Mortality[t-i]\" -> \"Mortality[t-1]\"\n\"Mortality[t-i]\" -> \"Outcome[t-i]\"\n\"Mortality[t-i]\" -> \"Restrictions[t-i]\"\n\"Mortality[t]\" -> \"Outcome[t]\"\n\"Mortality[t]\" -> \"Restrictions[t]\"\n\"Outcome[t-1]\" -> \"Outcome[t]\"\n\"Outcome[t-i]\" -> \"Outcome[t-1]\"\n\"Restrictions[t-1]\" -> \"Outcome[t-1]\"\n\"Restrictions[t-1]\" -> \"Outcome[t]\"\n\"Restrictions[t-1]\" -> \"Restrictions[t]\"\n\"Restrictions[t-i]\" -> \"Outcome[t-1]\"\n\"Restrictions[t-i]\" -> \"Outcome[t-i]\"\n\"Restrictions[t-i]\" -> \"Restrictions[t-1]\"\n\"Restrictions[t]\" -> \"Outcome[t]\"\n\"Trade[t-1]\" -> \"Outcome[t-1]\"\n\"Trade[t-1]\" -> \"Restrictions[t-1]\"\n\"Trade[t-1]\" -> \"Trade[t]\"\n\"Trade[t-i]\" -> \"Outcome[t-i]\"\n\"Trade[t-i]\" -> \"Restrictions[t-i]\"\n\"Trade[t-i]\" -> \"Trade[t-1]\"\n\"Trade[t]\" -> \"GDP/capita[t]\"\n\"Trade[t]\" -> \"Outcome[t]\"\n\"Trade[t]\" -> \"Restrictions[t]\"\n\"Violence[t-1]\" -> \"Outcome[t-1]\"\n\"Violence[t-1]\" -> \"Restrictions[t-1]\"\n\"Violence[t-1]\" -> \"Violence[t]\"\n\"Violence[t-i]\" -> \"Outcome[t-i]\"\n\"Violence[t-i]\" -> \"Restrictions[t-i]\"\n\"Violence[t-i]\" -> \"Violence[t-1]\"\n\"Violence[t]\" -> \"Outcome[t]\"\n\"Violence[t]\" -> \"Restrictions[t]\"\n\"`Civil liberties`[t-1]\" -> \"Outcome[t-1]\"\n\"`Civil liberties`[t-1]\" -> \"Restrictions[t-1]\"\n\"`Civil liberties`[t-1]\" -> \"`Civil liberties`[t]\"\n\"`Civil liberties`[t-i]\" -> \"Outcome[t-i]\"\n\"`Civil liberties`[t-i]\" -> \"Restrictions[t-i]\"\n\"`Civil liberties`[t-i]\" -> \"`Civil liberties`[t-1]\"\n\"`Civil liberties`[t]\" -> \"Outcome[t]\"\n\"`Civil liberties`[t]\" -> \"Restrictions[t]\"\n\"`Internal conflict`[t-1]\" -> \"Outcome[t-1]\"\n\"`Internal conflict`[t-1]\" -> \"Restrictions[t-1]\"\n\"`Internal conflict`[t-1]\" -> \"`Internal conflict`[t]\"\n\"`Internal conflict`[t-i]\" -> \"Outcome[t-i]\"\n\"`Internal conflict`[t-i]\" -> \"Restrictions[t-i]\"\n\"`Internal conflict`[t-i]\" -> \"`Internal conflict`[t-1]\"\n\"`Internal conflict`[t]\" -> \"Outcome[t]\"\n\"`Internal conflict`[t]\" -> \"Restrictions[t]\"\n\"`Rule of law`[t-1]\" -> \"Outcome[t-1]\"\n\"`Rule of law`[t-1]\" -> \"Restrictions[t-1]\"\n\"`Rule of law`[t-1]\" -> \"`Rule of law`[t]\"\n\"`Rule of law`[t-i]\" -> \"Outcome[t-i]\"\n\"`Rule of law`[t-i]\" -> \"Restrictions[t-i]\"\n\"`Rule of law`[t-i]\" -> \"`Rule of law`[t-1]\"\n\"`Rule of law`[t]\" -> \"Outcome[t]\"\n\"`Rule of law`[t]\" -> \"Restrictions[t]\"\n}\n')\n\nhuge_messy_dag_plot <- huge_messy_dag %>% \n  tidy_dagitty() %>% \n  mutate(var_type = case_when(\n    str_detect(name, \"Outcome\") ~ \"Outcome\",\n    str_detect(name, \"Restrictions\") ~ \"Restrictions\",\n    TRUE ~ \"Z\"\n  )) %>% \n  mutate(time_period = case_when(\n    str_detect(name, \"t-1\") ~ 2,\n    str_detect(name, \"t-i\") ~ 1,\n    TRUE ~ 3\n  )) %>% \n  mutate(arrow_color = case_when(\n    name == \"Restrictions[t-1]\" & to == \"Outcome[t]\" ~ \"#FF4136\",\n    TRUE ~ \"grey60\"\n  ))\n\nggplot(huge_messy_dag_plot, aes(x = x, y = y, xend = xend, yend = yend)) +\n  geom_dag_edges(aes(edge_colour = arrow_color)) +\n  geom_dag_point(aes(color = var_type, alpha = time_period), size = 12) +\n  geom_dag_text(data = filter(huge_messy_dag_plot, var_type == \"Outcome\"),\n                color = \"black\", size = pts(9), parse = TRUE) +\n  geom_dag_text(data = filter(huge_messy_dag_plot, var_type == \"Restrictions\"),\n                color = \"black\", size = pts(9), parse = TRUE) +\n  geom_dag_text(data = filter(huge_messy_dag_plot, var_type == \"Z\"),\n                color = \"black\", size = pts(9), parse = TRUE) +\n  scale_color_manual(values = c(\"#B10DC9\", \"#FF851B\", \"grey60\")) +\n  scale_y_reverse() +\n  guides(alpha = \"none\", color = \"none\") +\n  theme_dag()\n```\n\n::: {.cell-output-display}\n![](causal-model_files/figure-html/full-giant-dag-1.png){fig-align='center' width=100%}\n:::\n:::\n\n\n\n# Simpler model with families of confounders\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsimplerish_dag <- dagitty('\ndag {\n\"`Human rights & politics`[t-1]\" [adjusted,pos=\"5,1.5\"]\n\"`Human rights & politics`[t-i]\" [pos=\"1,1.5\"]\n\"`Human rights & politics`[t]\" [pos=\"9,1.5\"]\n\"`Economics & development`[t-1]\" [adjusted,pos=\"5,2.5\"]\n\"`Economics & development`[t-i]\" [pos=\"1,2.5\"]\n\"`Economics & development`[t]\" [pos=\"9,2.5\"]\n\"Outcome[t-1]\" [pos=\"6.5,1.75\"]\n\"Outcome[t-i]\" [adjusted,pos=\"2.5,1.75\"]\n\"Outcome[t]\" [outcome,pos=\"10.5,1.75\"]\n\"Restrictions[t-1]\" [exposure,pos=\"6,2.25\"]\n\"Restrictions[t-i]\" [adjusted,pos=\"2,2.25\"]\n\"Restrictions[t]\" [pos=\"10,2.25\"]\n\"`Unexpected shocks`[t-1]\" [adjusted,pos=\"5,2\"]\n\"`Unexpected shocks`[t-i]\" [pos=\"1,2\"]\n\"`Unexpected shocks`[t]\" [pos=\"9,2\"]\n\"`Human rights & politics`[t-1]\" -> \"`Human rights & politics`[t]\"\n\"`Human rights & politics`[t-1]\" -> \"Outcome[t-1]\"\n\"`Human rights & politics`[t-1]\" -> \"Restrictions[t-1]\"\n\"`Human rights & politics`[t-1]\" -> \"Restrictions[t]\"\n\"`Human rights & politics`[t-i]\" -> \"`Human rights & politics`[t-1]\"\n\"`Human rights & politics`[t-i]\" -> \"Outcome[t-i]\"\n\"`Human rights & politics`[t-i]\" -> \"Restrictions[t-i]\"\n\"`Human rights & politics`[t]\" -> \"Outcome[t]\"\n\"`Human rights & politics`[t]\" -> \"Restrictions[t]\"\n\"`Economics & development`[t-1]\" -> \"`Economics & development`[t]\"\n\"`Economics & development`[t-1]\" -> \"Outcome[t-1]\"\n\"`Economics & development`[t-1]\" -> \"Restrictions[t-1]\"\n\"`Economics & development`[t-1]\" -> \"Restrictions[t]\"\n\"`Economics & development`[t-i]\" -> \"`Economics & development`[t-1]\"\n\"`Economics & development`[t-i]\" -> \"Outcome[t-i]\"\n\"`Economics & development`[t-i]\" -> \"Restrictions[t-i]\"\n\"`Economics & development`[t]\" -> \"Outcome[t]\"\n\"`Economics & development`[t]\" -> \"Restrictions[t]\"\n\"Outcome[t-1]\" -> \"Outcome[t]\"\n\"Outcome[t-1]\" -> \"Restrictions[t]\"\n\"Outcome[t-i]\" -> \"Outcome[t-1]\"\n\"Outcome[t-i]\" -> \"Restrictions[t-1]\"\n\"Restrictions[t]\" -> \"Outcome[t]\"\n\"Restrictions[t-1]\" -> \"Outcome[t-1]\"\n\"Restrictions[t-i]\" -> \"Outcome[t-i]\"\n\"Restrictions[t-1]\" -> \"Outcome[t]\"\n\"Restrictions[t-1]\" -> \"Restrictions[t]\"\n\"Restrictions[t-i]\" -> \"Outcome[t-1]\"\n\"Restrictions[t-i]\" -> \"Restrictions[t-1]\"\n\"`Unexpected shocks`[t-1]\" -> \"Outcome[t-1]\"\n\"`Unexpected shocks`[t-1]\" -> \"Restrictions[t-1]\"\n\"`Unexpected shocks`[t-1]\" -> \"Restrictions[t]\"\n\"`Unexpected shocks`[t-1]\" -> \"`Unexpected shocks`[t]\"\n\"`Unexpected shocks`[t-i]\" -> \"Outcome[t-i]\"\n\"`Unexpected shocks`[t-i]\" -> \"Restrictions[t-i]\"\n\"`Unexpected shocks`[t-i]\" -> \"`Unexpected shocks`[t-1]\"\n\"`Unexpected shocks`[t]\" -> \"Outcome[t]\"\n\"`Unexpected shocks`[t]\" -> \"Restrictions[t]\"\n}\n')\n\nsimplerish_dag_plot <- simplerish_dag %>% \n  tidy_dagitty() %>% \n  mutate(var_type = case_when(\n    str_detect(name, \"Outcome\") ~ \"Outcome\",\n    str_detect(name, \"Restrictions\") ~ \"Restrictions\",\n    TRUE ~ \"Z\"\n  )) %>% \n  mutate(time_period = case_when(\n    str_detect(name, \"t-1\") ~ 2,\n    str_detect(name, \"t-i\") ~ 1,\n    TRUE ~ 3\n  )) %>% \n  mutate(arrow_color = case_when(\n    name == \"Restrictions[t-1]\" & to == \"Outcome[t]\" ~ \"#FF4136\",\n    TRUE ~ \"grey60\"\n  ))\n\nggplot(simplerish_dag_plot, aes(x = x, y = y, xend = xend, yend = yend)) +\n  geom_dag_edges(aes(edge_colour = arrow_color)) +\n  geom_dag_point(aes(color = var_type, alpha = time_period), size = 12) +\n  geom_dag_text(data = filter(simplerish_dag_plot, var_type == \"Outcome\"),\n                color = \"black\", size = pts(9), parse = TRUE) +\n  geom_dag_text(data = filter(simplerish_dag_plot, var_type == \"Restrictions\"),\n                color = \"black\", size = pts(9), parse = TRUE) +\n  geom_dag_text(data = filter(simplerish_dag_plot, var_type == \"Z\"),\n                color = \"black\", size = pts(9), parse = TRUE) +\n  scale_color_manual(values = c(\"#B10DC9\", \"#FF851B\", \"grey60\")) +\n  scale_y_reverse() +\n  guides(alpha = \"none\", color = \"none\") +\n  theme_dag()\n```\n\n::: {.cell-output-display}\n![](causal-model_files/figure-html/simplerish-dag-1.png){fig-align='center' width=100%}\n:::\n:::\n\n\n\n# Simplest model\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsimple_dag <- dagitty('\ndag {\n\"Outcome[t-i]\" [pos=\"1.5,2\"]\n\"Outcome[t-1]\" [pos=\"3.5,2\"]\n\"Outcome[t]\" [outcome,pos=\"6,2\"]\n\"Restrictions[t-i]\" [pos=\"1,1\"]\n\"Restrictions[t-1]\" [exposure,pos=\"3,1\"]\n\"Restrictions[t]\" [pos=\"5,1\"]\n\"Z[t-i]\" [pos=\"1,3\"]\n\"Z[t-1]\" [pos=\"3,3\"]\n\"Z[t]\" [pos=\"5,3\"]\n\"Outcome[t-1]\" -> \"Outcome[t]\"\n\"Outcome[t-1]\" -> \"Restrictions[t]\"\n\"Outcome[t-i]\" -> \"Outcome[t-1]\"\n\"Outcome[t-i]\" -> \"Restrictions[t-1]\"\n\"Restrictions[t]\" -> \"Outcome[t]\"\n\"Restrictions[t-1]\" -> \"Outcome[t-1]\"\n\"Restrictions[t-i]\" -> \"Outcome[t-i]\"\n\"Restrictions[t-1]\" -> \"Outcome[t]\"\n\"Restrictions[t-1]\" -> \"Restrictions[t]\"\n\"Restrictions[t-i]\" -> \"Outcome[t-1]\"\n\"Restrictions[t-i]\" -> \"Restrictions[t-1]\"\n\"Z[t-1]\" -> \"Outcome[t-1]\"\n\"Z[t-1]\" -> \"Restrictions[t-1]\"\n\"Z[t-1]\" -> \"Restrictions[t]\"\n\"Z[t-1]\" -> \"Z[t]\"\n\"Z[t-i]\" -> \"Outcome[t-i]\"\n\"Z[t-i]\" -> \"Restrictions[t-1]\"\n\"Z[t-i]\" -> \"Restrictions[t-i]\"\n\"Z[t-i]\" -> \"Z[t-1]\"\n\"Z[t]\" -> \"Outcome[t]\"\n\"Z[t]\" -> \"Restrictions[t]\"\n}\n') \n\nsimple_dag_plot <- simple_dag %>% \n  tidy_dagitty() %>% \n  mutate(var_type = case_when(\n    str_detect(name, \"Outcome\") ~ \"Outcome\",\n    str_detect(name, \"Restrictions\") ~ \"Restrictions\",\n    str_detect(name, \"Z\") ~ \"Z\"\n  )) %>% \n  mutate(time_period = case_when(\n    str_detect(name, \"t-1\") ~ 2,\n    str_detect(name, \"t-i\") ~ 1,\n    TRUE ~ 3\n  )) %>% \n  mutate(arrow_color = case_when(\n    name == \"Restrictions[t-1]\" & to == \"Outcome[t]\" ~ \"#FF4136\",\n    TRUE ~ \"grey60\"\n  )) %>% \n  mutate(letter_only = case_when(\n    str_detect(name, \"Outcome\") ~ str_replace(name, \"Outcome\", \"Y\"),\n    str_detect(name, \"Restrictions\") ~ str_replace(name, \"Restrictions\", \"X\"),\n    TRUE ~ name\n  ))\n\nsimple_dag_out <- ggplot(simple_dag_plot, aes(x = x, y = y, xend = xend, yend = yend)) +\n  geom_dag_edges(aes(edge_colour = arrow_color)) +\n  geom_dag_point(aes(color = var_type, alpha = time_period), size = 12) +\n  geom_dag_text(data = filter(simple_dag_plot, var_type == \"Outcome\"),\n                color = \"black\", size = pts(11), parse = TRUE, \n                nudge_y = 0.2, nudge_x = 0.3) +\n  geom_dag_text(data = filter(simple_dag_plot, var_type == \"Restrictions\"),\n                color = \"black\", size = pts(11), parse = TRUE, \n                nudge_y = -0.25) +\n  geom_dag_text(data = filter(simple_dag_plot, var_type == \"Z\"),\n                color = \"black\", size = pts(11), parse = TRUE,\n                nudge_y = 0) +\n  scale_color_manual(values = c(\"#B10DC9\", \"#FF851B\", \"grey60\")) +\n  guides(alpha = \"none\", color = \"none\") +\n  theme_dag()\nsimple_dag_out\n```\n\n::: {.cell-output-display}\n![](causal-model_files/figure-html/simple-dag-1.png){fig-align='center' width=100%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsimple_dag_letters_out <- ggplot(simple_dag_plot, aes(x = x, y = y, xend = xend, yend = yend)) +\n  geom_dag_edges(aes(edge_colour = arrow_color)) +\n  geom_dag_point(aes(color = var_type, alpha = time_period), size = 12) +\n  geom_dag_text(aes(label = letter_only),\n                color = \"black\", size = pts(11), parse = TRUE) +\n  scale_color_manual(values = c(\"#B10DC9\", \"#FF851B\", \"grey60\")) +\n  guides(alpha = \"none\", color = \"none\") +\n  theme_dag()\nsimple_dag_letters_out\n```\n\n::: {.cell-output-display}\n![](causal-model_files/figure-html/simple-dag-letters-1.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\n\n# ggsave(here(\"analysis\", \"output\", \"dag_simple_letters.pdf\"), simple_dag_letters_out,\n#        width = 7, height = 3.75, device = cairo_pdf)\n# ggsave(here(\"analysis\", \"output\", \"dag_simple_letters.png\"), simple_dag_letters_out,\n#        width = 7, height = 3.75, res = 300, device = ragg::agg_png)\n```\n:::\n\n\n\n\n# Adjustment sets\n\nThese DAGs are complex—especially the one with every possible node. However, they have important analytical value. We cannot randomly assign countries to impose anti-NGO laws or restrict the environment for civil society—doing that is completely infeasable (and unethical!). This means that we cannot use experimental data to measure the causal effect of anti-NGO restrictions on foreign aid, or $E[\\text{Aid} \\mid do(\\text{Restrictions})]$. We also don't have any quasi-experimental situations that would allow for context-based identification of the effect of restrictions on aid.\n\nSimply measuring $E[\\text{Aid} \\mid \\text{Restrictions}]$ is trivial—just run `lm(aid ~ restrictions)` and look at the coefficient. However, this estimate cannot be interpreted in any sort of causal way, since correlation is not causation. Using the logic of *do*-calculus, we can actually use the relationships between the nodes in the DAG to transform $E[\\text{Aid} \\mid do(\\text{Restrictions})]$ into a *do*-free expression by making statistical adjustments and closing backdoor pathways that open up spurious relationships between restrictions and aid. As long as we can find a minimally sufficient adjustment set—or a set of nodes or variables that need to be adjusted in order to ensure that restrictions is *d*-separated from aid—we can isolate and identify the causal link between restrictions and aid.\n\nRather than go through the complex math behind the three rules of *do*-calculus, we can use R (or dagitty.net) to identify minimal sufficient adjustment sets based on the three DAGs above.\n\n- Huge complicated DAG:\n\n\n  ::: {.cell layout-align=\"center\"}\n  \n  ```{.r .cell-code  code-fold=\"show\"}\n  huge_messy_dag %>%\n    adjustmentSets()\n  ## { Corruption[t-1], Democracy[t-1], Disasters[t-1], Education[t-1],\n  ##   GDP/capita[t-1], Health[t-1], Mortality[t-1], Restrictions[t-i], Trade[t-1],\n  ##   Violence[t-1], `Civil liberties`[t-1], `Internal conflict`[t-1], `Rule of\n  ##   law`[t-1] }\n  ```\n  :::\n\n\n- Simpler-ish DAG:\n\n\n  ::: {.cell layout-align=\"center\"}\n  \n  ```{.r .cell-code  code-fold=\"show\"}\n  simplerish_dag %>%\n    adjustmentSets()\n  ## { Outcome[t-i], Restrictions[t-i], `Economics & development`[t-1], `Human rights\n  ##   & politics`[t-1], `Unexpected shocks`[t-1] }\n  ```\n  :::\n\n\n- Simple DAG:\n\n\n  ::: {.cell layout-align=\"center\"}\n  \n  ```{.r .cell-code  code-fold=\"show\"}\n  simple_dag %>%\n    adjustmentSets()\n  ## { Outcome[t-i], Restrictions[t-i], Z[t-1] }\n  ```\n  :::\n\n\n\\ \n\nIn other words, if we want to isolate the causal effect of anti-NGO restrictions in time $t$ on aid in time $t+1$ (i.e. the effect of lagged restrictions), we need to adjust for lagged aid ($t-1$), lagged restrictions ($t-1$), and time-varying confounders ($t$). \n\nFortunately, marginal structural models allow us to make all of these adjustments using special inverse probability weights that take this lagging structure and treatment history into account.\n\n$$\n\\text{Continuous stabilized IPW}_{it} = \\prod^t_{t = 1} \\frac{f_{X | \\bar{X}, V}[(X_{it} | \\bar{X}_{i, t-1}, V_i); \\mu_1, \\sigma^2_1]}{f_{X | \\bar{X}, Y, Z, V}[(X_{it} | \\bar{X}_{i, t-1}, Y_{i, t-1}, Z_{it}, V_i), \\mu_2, \\sigma^2_2]}\n$$\n\n- The numerator contains the probability of the observed treatment status ($X_{it}$) at each time given the previous history of treatment ($\\bar{X}_{i, t-1}$) and time invariant confounders ($V_i$). \n- The denominator contains the probability of the observed treatment status ($X_{it}$) at each time given the previous history of treatment ($\\bar{X}_{i, t-1}$), previous outcome ($Y_{i, t-1}$), time *varying* confounders ($Z_{it}$), and time *invariant* confounders ($V_i$).\n- These two probability distributions have a mean of $\\mu_{1, 2}$ and variance of $\\sigma^2_{1, 2}$.\n\nFinally, these weights are used in an outcome model similar to this:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"show\"}\nlm(outcome ~ lag_treatment, weights = ipw)\n```\n:::\n\n\nDoing this process closes the backdoor pathways between lagged restrictions and present aid and is theoretically sufficient for isolating the causal link between the two.\n\n\n# Final variables to use\n\nBased on these DAGs, here are the variables we use in our treatment and outcome models:\n\n- **Outcome**\n  - H~1~: log aid in $t$ (`total_oda_lead` and `total_oda_log_lead`)\n  - H~2~: proportion of aid given for contentious causes in $t$ (`prop_contentious`)\n  - H~3~: proportion of aid given to domestic/international NGOS in $t$ (`prop_ngo_dom` and `prop_ngo_foreign`)\n- **Treatment**\n  - Anti-civil society laws and general restrictive environment in $t-1$ (`barriers_total` and `v2xcs_ccsi`)\n- **Time-varying confounders** (all in $t-1$)\n  - Human rights and politics\n    - Electoral democracy: `v2x_polyarchy`\n    - Corruption: `v2x_corr`\n    - Rule of law: `v2x_rule`\n    - Civil liberties index: `v2x_civlib`\n    - Physical violence index: `v2x_clphy`\n    - Private civil liberties index: `v2x_clpriv`\n  - Economics and development\n    - Wealth: `gdpcap_log`\n    - International trade: `un_trade_pct_gdp`\n    - Educational equality: `v2peedueq`\n    - Health equality: `v2pehealth`\n    - Infant mortality rate: `e_peinfmor`\n  - Unexpected shocks\n    - Internal conflict: `internal_conflict_past_5`\n    - Natural disasters: `natural_dis_count`\n- **Time-invarying confounders**\n  - Country code included as random intercepts and year included as a population-level trend and random slope (`year + (1 + year | gwcode)`)\n",
    "supporting": [
      "causal-model_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
{
  "hash": "b12f956da99e874692fe75e801f2dcff",
  "result": {
    "markdown": "---\ntitle: \"H~1~: Effect of anti-NGO crackdown on total ODA\"\nauthor: \"Suparna Chaudhry and Andrew Heiss\"\ndate: \"2022-12-07\"\nbibliography: \"/Users/andrew/Desktop/Crackdowns and aid/testy-turtle/manuscript/bibliography.bib\"\ncsl: \"/Users/andrew/Desktop/Crackdowns and aid/testy-turtle/manuscript/pandoc/csl/chicago-author-date.csl\"\nlink-citations: true\neditor_options: \n  chunk_output_type: console\n---\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(targets)\nlibrary(brms)\nlibrary(tidybayes)\nlibrary(bayesplot)\nlibrary(extraDistr)\n# library(fixest)\nlibrary(broom)\nlibrary(broom.mixed)\nlibrary(modelsummary)\nlibrary(patchwork)\nlibrary(scales)\nlibrary(latex2exp)\nlibrary(kableExtra)\nlibrary(here)\n\ncolor_scheme_set(\"viridisC\")\n\nmy_seed <- 1234\nset.seed(my_seed)\n\n# Stuff from targets\n# Plotting functions\ninvisible(list2env(tar_read(graphic_functions), .GlobalEnv))\ninvisible(list2env(tar_read(misc_funs), .GlobalEnv))\n\n# Data\ndf_country_aid <- tar_read(country_aid_final)\ndf_country_aid_laws <- filter(df_country_aid, laws)\n\n# Treatment models\ntar_load(c(m_oda_treatment_total, m_oda_treatment_advocacy, \n           m_oda_treatment_entry, m_oda_treatment_funding, \n           m_oda_treatment_ccsi))\n\n# IPTW data\ntar_load(c(df_oda_iptw_total, df_oda_iptw_advocacy, \n           df_oda_iptw_entry, df_oda_iptw_funding,\n           df_oda_iptw_ccsi))\n\n# Outcome models\ntar_load(c(m_oda_outcome_total, m_oda_outcome_advocacy, \n           m_oda_outcome_entry, m_oda_outcome_funding,\n           m_oda_outcome_ccsi))\n\n# Results tables\ntar_load(c(models_tbl_h1_treatment_num, models_tbl_h1_treatment_denom))\ntar_load(c(models_tbl_h1_outcome_dejure, models_tbl_h1_outcome_defacto))\n```\n:::\n\n\n## Weight models\n\n- Numerator is treatment ~ lagged treatment + treatment history + non-varying confounders\n- Denominator is treatment ~ lagged treatment + treatment history + lagged outcome + time-varying confounders + non-varying confounders\n\n$$\nsw = \\prod^t_{t = 1} \\frac{\\phi(T_{it} | T_{i, t-1}, C_i)}{\\phi(T_{it} | T_{i, t-1}, D_{i, t-1}, C_i)}\n$$\n\n### Priors for weight models\n\nWe use [generic weakly informative priors](https://mc-stan.org/users/documentation/case-studies/weakly_informative_shapes.html) for our model parameters:\n\n- Intercept: $\\text{Student t} (5, 0, 1.5)$\n- Coefficients: $\\mathcal{N} (0, 2.5)$\n- Sigma: $\\operatorname{Cauchy} (0, 1)$\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Location-scale version of the t-distribution\npri_int <- ggplot() +\n  stat_function(fun = ~ dlst(.x, df = 5, mu = 0, sigma = 1.5),\n                geom = \"area\", fill = \"grey80\", color = \"black\") +\n  labs(x = TeX(r'($\\textbf{Intercept}\\ (β_0)$)')) +\n  annotate(geom = \"label\", x = 0, y = 0.0635, label = \"Student t(5, 0, 1.5)\", size = pts(9)) +\n  xlim(-10, 10) +\n  theme_donors(prior = TRUE)\n## Warning: The `size` argument of `element_line()` is deprecated as of ggplot2 3.4.0.\n## ℹ Please use the `linewidth` argument instead.\n\npri_coef <- ggplot() +\n  stat_function(fun = ~ dnorm(.x, 0, 2.5),\n                geom = \"area\", fill = \"grey80\", color = \"black\") +\n  xlim(-10, 10) +\n  labs(x = TeX(r'($\\textbf{Coefficients}\\ (β_x)$)')) +\n  annotate(geom = \"label\", x = 0, y = 0.04, label = \"N(0, 3)\", size = pts(9)) +\n  theme_donors(prior = TRUE)\n\npri_sigma <- ggplot() +\n  stat_function(fun = ~ dcauchy(.x, location = 0, scale = 1),\n                geom = \"area\", fill = \"grey80\", color = \"black\") +\n  labs(x = TeX(r'($\\textbf{Errors}\\ (σ)$)')) +\n  annotate(geom = \"label\", x = 5, y = 0.08, label = \"Cauchy(0, 1)\", size = pts(9)) +\n  xlim(0, 10) +\n  theme_donors(prior = TRUE)\n\n(pri_int + pri_coef + pri_sigma)\n```\n\n::: {.cell-output-display}\n![](models_total-aid_files/figure-html/plot-weight-priors-1.png){fig-align='center' width=85%}\n:::\n:::\n\n\n### Check weight models {.tabset}\n\nWe check a couple of the numerator and denominator models for convergence and mixing and fit. They're all pretty much the same\n\n#### Numerator\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npp_check(m_oda_treatment_total$model_num, type = \"dens_overlay\", ndraws = 10) +\n  theme_donors()\n```\n\n::: {.cell-output-display}\n![](models_total-aid_files/figure-html/h1-check-numerator-1.png){fig-align='center' width=85%}\n:::\n\n```{.r .cell-code}\n\nm_oda_treatment_total$model_num %>% \n  posterior::as_draws_array() %>%\n  mcmc_trace(pars = vars(-starts_with(\"r_gwcode\"), -starts_with(\"z_\"),\n                         -starts_with(\"r_region\"), -starts_with(\"bQ\"), -lp__)) +\n  theme_donors() +\n  theme(legend.position = \"right\")\n```\n\n::: {.cell-output-display}\n![](models_total-aid_files/figure-html/h1-check-numerator-2.png){fig-align='center' width=85%}\n:::\n:::\n\n\n#### Denominator\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npp_check(m_oda_treatment_total$model_denom, type = \"dens_overlay\", ndraws = 10) +\n  theme_donors()\n```\n\n::: {.cell-output-display}\n![](models_total-aid_files/figure-html/h1-check-denominator-1.png){fig-align='center' width=85%}\n:::\n\n```{.r .cell-code}\n\nm_oda_treatment_total$model_denom %>% \n  posterior::as_draws_array() %>%\n  mcmc_trace(pars = vars(-starts_with(\"r_gwcode\"), -starts_with(\"z_\"),\n                         -starts_with(\"r_region\"), -starts_with(\"bQ\"), -lp__)) +\n  theme_donors() +\n  theme(legend.position = \"right\")\n```\n\n::: {.cell-output-display}\n![](models_total-aid_files/figure-html/h1-check-denominator-2.png){fig-align='center' width=85%}\n:::\n:::\n\n\n### Check weights {.tabset}\n\nIPTWs should generally have a mean of 1 and shouldn't be too incredibly high. When they're big, it's a good idea to truncate them at some level. The truncation threshold matters substantially—as seen below, the ATE when using V-Dem's core civil society index as the treatment varies substantially at different truncation thresholds.\n\n#### Total ODA\n\nSweet.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsummary(df_oda_iptw_total$iptw)\n##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. \n## 0.004013 0.855105 0.961660 1.068674 1.052578 9.767233\n\ndf_oda_iptw_total %>% \n  ggplot(aes(x = iptw)) +\n  geom_histogram(binwidth = 0.5, boundary = 0) +\n  theme_donors()\n```\n\n::: {.cell-output-display}\n![](models_total-aid_files/figure-html/iptws-total-oda-1.png){fig-align='center' width=85%}\n:::\n:::\n\n\n#### Advocacy\n\nLovely.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsummary(df_oda_iptw_advocacy$iptw)\n##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n##  0.1147  0.9156  0.9777  1.0217  1.0281  8.8370\n\ndf_oda_iptw_advocacy %>% \n  ggplot(aes(x = iptw)) +\n  geom_histogram(binwidth = 1, boundary = 0) +\n  theme_donors()\n```\n\n::: {.cell-output-display}\n![](models_total-aid_files/figure-html/iptws-advocacy-1.png){fig-align='center' width=85%}\n:::\n:::\n\n\n#### Entry\n\nFantastic.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsummary(df_oda_iptw_entry$iptw)\n##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n## 0.05043 0.90155 0.98250 1.01962 1.04491 5.26782\n\ndf_oda_iptw_entry %>% \n  ggplot(aes(x = iptw)) +\n  geom_histogram(binwidth = 0.5, boundary = 0) +\n  theme_donors()\n```\n\n::: {.cell-output-display}\n![](models_total-aid_files/figure-html/iptws-entry-1.png){fig-align='center' width=85%}\n:::\n:::\n\n\n#### Funding\n\nGreat.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsummary(df_oda_iptw_funding$iptw)\n##      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. \n##  0.000975  0.868378  0.961939  1.079371  1.021611 20.032867\n\ndf_oda_iptw_funding %>% \n  ggplot(aes(x = iptw)) +\n  geom_histogram(binwidth = 2, boundary = 0) +\n  theme_donors()\n```\n\n::: {.cell-output-display}\n![](models_total-aid_files/figure-html/iptws-funding-1.png){fig-align='center' width=85%}\n:::\n:::\n\n\n#### Core civil society index\n\nlol these blow up. Check out the maximum:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsummary(df_oda_iptw_ccsi$iptw)\n##      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. \n## 0.000e+00 0.000e+00 0.000e+00 1.626e+10 1.000e+00 5.561e+12\n```\n:::\n\n\nWe truncate at four different thresholds: 100, 500, 1,000, and 5,000:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nplot_iptw_ccsi <- bind_rows(\n  df_oda_iptw_ccsi %>% mutate(threshold = 100, iptw = ifelse(iptw > 100, 100, iptw)),\n  df_oda_iptw_ccsi %>% mutate(threshold = 500, iptw = ifelse(iptw > 500, 500, iptw)),\n  df_oda_iptw_ccsi %>% mutate(threshold = 1000, iptw = ifelse(iptw > 1000, 1000, iptw)),\n  df_oda_iptw_ccsi %>% mutate(threshold = 5000, iptw = ifelse(iptw > 5000, 5000, iptw))\n) %>% \n  mutate(threshold = paste0(\"Truncated at \", comma(threshold)),\n         threshold = fct_inorder(threshold))\n\nplot_iptw_ccsi %>% \n  ggplot(aes(x = iptw)) +\n  geom_histogram(bins = 50, boundary = 0) +\n  facet_wrap(vars(threshold), scales = \"free_x\") +\n  theme_donors()\n```\n\n::: {.cell-output-display}\n![](models_total-aid_files/figure-html/iptws-ccsi-1.png){fig-align='center' width=85%}\n:::\n:::\n\n\n### Results {.tabset}\n\nThese are less important since we just use these treatment models to generate weights *and* because interpreting each coefficient when trying to isolate casual effects is unimportant and [a \"nuisance\"](https://arxiv.org/abs/2005.10314). But here are the results anyway:\n\n#### Numerator models\n\n\n::: {#tbl-h1-num .cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# model_names <- paste0(\"(\", 1:length(models_tbl_h1_treatment_num), \")\")\nmodel_names <- 1:length(models_tbl_h1_treatment_num)\nnames(models_tbl_h1_treatment_num) <- model_names\n\ntreatment_names <- c(\"Treatment\", \"Total barriers (t)\", \"Barriers to advocacy (t)\", \n                     \"Barriers to entry (t)\", \"Barriers to funding (t)\", \"CCSI (t)\")\ntreatment_rows <- as.data.frame(t(treatment_names))\nattr(treatment_rows, \"position\") <- 1\n\ncoef_list_num <- list(\n  \"b_barriers_total_lag1\" = \"Treatment (t − 1)\",\n  \"b_advocacy_lag1\" = \"Treatment (t − 1)\",\n  \"b_entry_lag1\" = \"Treatment (t − 1)\",\n  \"b_funding_lag1\" = \"Treatment (t − 1)\",\n  \"b_v2xcs_ccsi_lag1\" = \"Treatment (t − 1)\",\n  \"b_Intercept\" = \"Intercept\"\n)\n\nmodelsummary(models_tbl_h1_treatment_num,\n             statistic = \"[{conf.low}, {conf.high}]\",\n             coef_map = coef_list_num,\n             add_rows = treatment_rows,\n             gof_omit = \"ELPD\",\n             escape = FALSE,\n             notes = list(\"Posterior means; 95% credible intervals in brackets\"))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table style=\"NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto;\" class=\"table\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:center;\"> 1 </th>\n   <th style=\"text-align:center;\"> 2 </th>\n   <th style=\"text-align:center;\"> 3 </th>\n   <th style=\"text-align:center;\"> 4 </th>\n   <th style=\"text-align:center;\"> 5 </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Treatment </td>\n   <td style=\"text-align:center;\"> Total barriers (t) </td>\n   <td style=\"text-align:center;\"> Barriers to advocacy (t) </td>\n   <td style=\"text-align:center;\"> Barriers to entry (t) </td>\n   <td style=\"text-align:center;\"> Barriers to funding (t) </td>\n   <td style=\"text-align:center;\"> CCSI (t) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Treatment (t − 1) </td>\n   <td style=\"text-align:center;\"> 0.987 </td>\n   <td style=\"text-align:center;\"> 0.996 </td>\n   <td style=\"text-align:center;\"> 0.973 </td>\n   <td style=\"text-align:center;\"> 0.987 </td>\n   <td style=\"text-align:center;\"> 0.830 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> [0.972, 1.001] </td>\n   <td style=\"text-align:center;\"> [0.982, 1.009] </td>\n   <td style=\"text-align:center;\"> [0.957, 0.989] </td>\n   <td style=\"text-align:center;\"> [0.971, 1.002] </td>\n   <td style=\"text-align:center;\"> [0.810, 0.849] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Intercept </td>\n   <td style=\"text-align:center;\"> 0.087 </td>\n   <td style=\"text-align:center;\"> 0.015 </td>\n   <td style=\"text-align:center;\"> 0.052 </td>\n   <td style=\"text-align:center;\"> 0.030 </td>\n   <td style=\"text-align:center;\"> 0.120 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;box-shadow: 0px 1px\">  </td>\n   <td style=\"text-align:center;box-shadow: 0px 1px\"> [0.064, 0.110] </td>\n   <td style=\"text-align:center;box-shadow: 0px 1px\"> [0.010, 0.020] </td>\n   <td style=\"text-align:center;box-shadow: 0px 1px\"> [0.039, 0.064] </td>\n   <td style=\"text-align:center;box-shadow: 0px 1px\"> [0.020, 0.039] </td>\n   <td style=\"text-align:center;box-shadow: 0px 1px\"> [0.106, 0.134] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Num.Obs. </td>\n   <td style=\"text-align:center;\"> 3011 </td>\n   <td style=\"text-align:center;\"> 3011 </td>\n   <td style=\"text-align:center;\"> 3011 </td>\n   <td style=\"text-align:center;\"> 3011 </td>\n   <td style=\"text-align:center;\"> 3272 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> R2 </td>\n   <td style=\"text-align:center;\"> 0.939 </td>\n   <td style=\"text-align:center;\"> 0.947 </td>\n   <td style=\"text-align:center;\"> 0.925 </td>\n   <td style=\"text-align:center;\"> 0.938 </td>\n   <td style=\"text-align:center;\"> 0.958 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> R2 Marg. </td>\n   <td style=\"text-align:center;\"> 0.938 </td>\n   <td style=\"text-align:center;\"> 0.947 </td>\n   <td style=\"text-align:center;\"> 0.924 </td>\n   <td style=\"text-align:center;\"> 0.938 </td>\n   <td style=\"text-align:center;\"> 0.903 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> LOOIC </td>\n   <td style=\"text-align:center;\"> 4023.2 </td>\n   <td style=\"text-align:center;\"> −4059.3 </td>\n   <td style=\"text-align:center;\"> 111.7 </td>\n   <td style=\"text-align:center;\"> −326.8 </td>\n   <td style=\"text-align:center;\"> −9372.2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> LOOIC s.e. </td>\n   <td style=\"text-align:center;\"> 531.8 </td>\n   <td style=\"text-align:center;\"> 623.4 </td>\n   <td style=\"text-align:center;\"> 440.1 </td>\n   <td style=\"text-align:center;\"> 690.6 </td>\n   <td style=\"text-align:center;\"> 343.7 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> WAIC </td>\n   <td style=\"text-align:center;\"> 4026.6 </td>\n   <td style=\"text-align:center;\"> −4070.9 </td>\n   <td style=\"text-align:center;\"> 112.0 </td>\n   <td style=\"text-align:center;\"> −314.9 </td>\n   <td style=\"text-align:center;\"> −9371.8 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> RMSE </td>\n   <td style=\"text-align:center;\"> 1.32 </td>\n   <td style=\"text-align:center;\"> 0.34 </td>\n   <td style=\"text-align:center;\"> 0.66 </td>\n   <td style=\"text-align:center;\"> 0.59 </td>\n   <td style=\"text-align:center;\"> 0.33 </td>\n  </tr>\n</tbody>\n<tfoot><tr><td style=\"padding: 0; \" colspan=\"100%\">\n<sup></sup> Posterior means; 95% credible intervals in brackets</td></tr></tfoot>\n</table>\n\n`````\n:::\n:::\n\n\n#### Denominator models\n\n\n::: {#tbl-h1-denom .cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# model_names <- paste0(\"(\", 1:length(models_tbl_h1_treatment_denom), \")\")\nmodel_names <- 1:length(models_tbl_h1_treatment_denom)\nnames(models_tbl_h1_treatment_denom) <- model_names\n\ntreatment_names <- c(\"Treatment\", \"Total barriers (t)\", \"Barriers to advocacy (t)\", \n                     \"Barriers to entry (t)\", \"Barriers to funding (t)\", \"CCSI (t)\")\ntreatment_rows <- as.data.frame(t(treatment_names))\nattr(treatment_rows, \"position\") <- 1\n\ncoef_list_denom <- list(\n  \"b_barriers_total_lag1\" = \"Treatment (t − 1)\",\n  \"b_advocacy_lag1\" = \"Treatment (t − 1)\",\n  \"b_entry_lag1\" = \"Treatment (t − 1)\",\n  \"b_funding_lag1\" = \"Treatment (t − 1)\",\n  \"b_v2xcs_ccsi_lag1\" = \"Treatment (t − 1)\",\n  \"b_v2x_polyarchy\" = \"Polyarchy\",\n  \"b_v2x_corr\" = \"Corruption index\",\n  \"b_v2x_rule\" = \"Rule of law index\",\n  \"b_v2x_civlib\" = \"Civil liberties index\",\n  \"b_v2x_clphy\" = \"Physical violence index\",\n  \"b_v2x_clpriv\" = \"Private civil liberties index\",\n  \"b_gdpcap_log\" = \"Log GDP/capita\",\n  \"b_un_trade_pct_gdp\" = \"Percent of GDP from trade\",\n  \"b_v2peedueq\" = \"Educational equality index\",\n  \"b_v2pehealth\" = \"Health equality index\",\n  \"b_e_peinfmor\" = \"Infant mortality rate\",\n  \"b_internal_conflict_past_5TRUE\" = \"Internal conflict in past 5 years\",\n  \"b_natural_dis_count\" = \"Count of natural disasters\",\n  \"b_Intercept\" = \"Intercept\"\n)\n\nmodelsummary(models_tbl_h1_treatment_denom,\n             statistic = \"[{conf.low}, {conf.high}]\",\n             coef_map = coef_list_denom,\n             add_rows = treatment_rows,\n             gof_omit = \"ELPD\",\n             escape = FALSE,\n             notes = list(\"Posterior means; 95% credible intervals in brackets\"))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table style=\"NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto;\" class=\"table\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:center;\"> 1 </th>\n   <th style=\"text-align:center;\"> 2 </th>\n   <th style=\"text-align:center;\"> 3 </th>\n   <th style=\"text-align:center;\"> 4 </th>\n   <th style=\"text-align:center;\"> 5 </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Treatment </td>\n   <td style=\"text-align:center;\"> Total barriers (t) </td>\n   <td style=\"text-align:center;\"> Barriers to advocacy (t) </td>\n   <td style=\"text-align:center;\"> Barriers to entry (t) </td>\n   <td style=\"text-align:center;\"> Barriers to funding (t) </td>\n   <td style=\"text-align:center;\"> CCSI (t) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Treatment (t − 1) </td>\n   <td style=\"text-align:center;\"> 0.974 </td>\n   <td style=\"text-align:center;\"> 0.992 </td>\n   <td style=\"text-align:center;\"> 0.965 </td>\n   <td style=\"text-align:center;\"> 0.973 </td>\n   <td style=\"text-align:center;\"> 0.495 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> [0.959, 0.989] </td>\n   <td style=\"text-align:center;\"> [0.977, 1.007] </td>\n   <td style=\"text-align:center;\"> [0.949, 0.979] </td>\n   <td style=\"text-align:center;\"> [0.956, 0.987] </td>\n   <td style=\"text-align:center;\"> [0.467, 0.519] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Polyarchy </td>\n   <td style=\"text-align:center;\"> −0.098 </td>\n   <td style=\"text-align:center;\"> 0.015 </td>\n   <td style=\"text-align:center;\"> −0.082 </td>\n   <td style=\"text-align:center;\"> −0.044 </td>\n   <td style=\"text-align:center;\"> 0.010 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> [−0.280, 0.071] </td>\n   <td style=\"text-align:center;\"> [−0.031, 0.062] </td>\n   <td style=\"text-align:center;\"> [−0.175, 0.012] </td>\n   <td style=\"text-align:center;\"> [−0.132, 0.040] </td>\n   <td style=\"text-align:center;\"> [−0.020, 0.038] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Corruption index </td>\n   <td style=\"text-align:center;\"> −0.104 </td>\n   <td style=\"text-align:center;\"> −0.023 </td>\n   <td style=\"text-align:center;\"> −0.035 </td>\n   <td style=\"text-align:center;\"> −0.049 </td>\n   <td style=\"text-align:center;\"> −0.025 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> [−0.277, 0.092] </td>\n   <td style=\"text-align:center;\"> [−0.070, 0.022] </td>\n   <td style=\"text-align:center;\"> [−0.129, 0.057] </td>\n   <td style=\"text-align:center;\"> [−0.132, 0.043] </td>\n   <td style=\"text-align:center;\"> [−0.061, 0.010] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Rule of law index </td>\n   <td style=\"text-align:center;\"> −0.145 </td>\n   <td style=\"text-align:center;\"> −0.052 </td>\n   <td style=\"text-align:center;\"> −0.039 </td>\n   <td style=\"text-align:center;\"> −0.054 </td>\n   <td style=\"text-align:center;\"> 0.024 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> [−0.335, 0.069] </td>\n   <td style=\"text-align:center;\"> [−0.102, 0.002] </td>\n   <td style=\"text-align:center;\"> [−0.147, 0.066] </td>\n   <td style=\"text-align:center;\"> [−0.146, 0.048] </td>\n   <td style=\"text-align:center;\"> [−0.017, 0.063] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Civil liberties index </td>\n   <td style=\"text-align:center;\"> −0.429 </td>\n   <td style=\"text-align:center;\"> −0.121 </td>\n   <td style=\"text-align:center;\"> −0.167 </td>\n   <td style=\"text-align:center;\"> −0.106 </td>\n   <td style=\"text-align:center;\"> 0.881 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> [−0.934, 0.118] </td>\n   <td style=\"text-align:center;\"> [−0.253, 0.022] </td>\n   <td style=\"text-align:center;\"> [−0.453, 0.115] </td>\n   <td style=\"text-align:center;\"> [−0.368, 0.131] </td>\n   <td style=\"text-align:center;\"> [0.800, 0.956] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Physical violence index </td>\n   <td style=\"text-align:center;\"> 0.269 </td>\n   <td style=\"text-align:center;\"> 0.069 </td>\n   <td style=\"text-align:center;\"> 0.115 </td>\n   <td style=\"text-align:center;\"> 0.073 </td>\n   <td style=\"text-align:center;\"> −0.226 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> [0.039, 0.501] </td>\n   <td style=\"text-align:center;\"> [0.012, 0.134] </td>\n   <td style=\"text-align:center;\"> [−0.010, 0.244] </td>\n   <td style=\"text-align:center;\"> [−0.038, 0.190] </td>\n   <td style=\"text-align:center;\"> [−0.262, −0.190] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Private civil liberties index </td>\n   <td style=\"text-align:center;\"> 0.120 </td>\n   <td style=\"text-align:center;\"> 0.051 </td>\n   <td style=\"text-align:center;\"> 0.070 </td>\n   <td style=\"text-align:center;\"> −0.007 </td>\n   <td style=\"text-align:center;\"> −0.182 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> [−0.144, 0.408] </td>\n   <td style=\"text-align:center;\"> [−0.021, 0.125] </td>\n   <td style=\"text-align:center;\"> [−0.078, 0.222] </td>\n   <td style=\"text-align:center;\"> [−0.145, 0.119] </td>\n   <td style=\"text-align:center;\"> [−0.224, −0.139] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Log GDP/capita </td>\n   <td style=\"text-align:center;\"> −0.018 </td>\n   <td style=\"text-align:center;\"> −0.003 </td>\n   <td style=\"text-align:center;\"> −0.005 </td>\n   <td style=\"text-align:center;\"> −0.009 </td>\n   <td style=\"text-align:center;\"> −0.007 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> [−0.040, 0.002] </td>\n   <td style=\"text-align:center;\"> [−0.009, 0.003] </td>\n   <td style=\"text-align:center;\"> [−0.017, 0.006] </td>\n   <td style=\"text-align:center;\"> [−0.019, 0.002] </td>\n   <td style=\"text-align:center;\"> [−0.013, −0.001] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Percent of GDP from trade </td>\n   <td style=\"text-align:center;\"> −0.010 </td>\n   <td style=\"text-align:center;\"> 0.005 </td>\n   <td style=\"text-align:center;\"> −0.010 </td>\n   <td style=\"text-align:center;\"> −0.004 </td>\n   <td style=\"text-align:center;\"> −0.003 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> [−0.052, 0.033] </td>\n   <td style=\"text-align:center;\"> [−0.007, 0.016] </td>\n   <td style=\"text-align:center;\"> [−0.033, 0.013] </td>\n   <td style=\"text-align:center;\"> [−0.024, 0.018] </td>\n   <td style=\"text-align:center;\"> [−0.012, 0.004] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Educational equality index </td>\n   <td style=\"text-align:center;\"> −0.010 </td>\n   <td style=\"text-align:center;\"> −0.0007 </td>\n   <td style=\"text-align:center;\"> 0.0002 </td>\n   <td style=\"text-align:center;\"> −0.010 </td>\n   <td style=\"text-align:center;\"> −0.007 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> [−0.038, 0.020] </td>\n   <td style=\"text-align:center;\"> [−0.008, 0.007] </td>\n   <td style=\"text-align:center;\"> [−0.015, 0.016] </td>\n   <td style=\"text-align:center;\"> [−0.023, 0.005] </td>\n   <td style=\"text-align:center;\"> [−0.013, −0.001] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Health equality index </td>\n   <td style=\"text-align:center;\"> 0.016 </td>\n   <td style=\"text-align:center;\"> 0.0006 </td>\n   <td style=\"text-align:center;\"> −0.001 </td>\n   <td style=\"text-align:center;\"> 0.016 </td>\n   <td style=\"text-align:center;\"> −0.002 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> [−0.016, 0.049] </td>\n   <td style=\"text-align:center;\"> [−0.007, 0.009] </td>\n   <td style=\"text-align:center;\"> [−0.018, 0.017] </td>\n   <td style=\"text-align:center;\"> [0.001, 0.033] </td>\n   <td style=\"text-align:center;\"> [−0.008, 0.004] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Infant mortality rate </td>\n   <td style=\"text-align:center;\"> −0.0009 </td>\n   <td style=\"text-align:center;\"> −0.0002 </td>\n   <td style=\"text-align:center;\"> −0.0003 </td>\n   <td style=\"text-align:center;\"> −0.0005 </td>\n   <td style=\"text-align:center;\"> 0.00001 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> [−0.002, −0.00006] </td>\n   <td style=\"text-align:center;\"> [−0.0004, 0.00007] </td>\n   <td style=\"text-align:center;\"> [−0.0007, 0.0002] </td>\n   <td style=\"text-align:center;\"> [−0.0009, −0.00008] </td>\n   <td style=\"text-align:center;\"> [−0.0002, 0.0002] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Internal conflict in past 5 years </td>\n   <td style=\"text-align:center;\"> 0.008 </td>\n   <td style=\"text-align:center;\"> 0.004 </td>\n   <td style=\"text-align:center;\"> 0.001 </td>\n   <td style=\"text-align:center;\"> 0.003 </td>\n   <td style=\"text-align:center;\"> 0.007 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> [−0.034, 0.052] </td>\n   <td style=\"text-align:center;\"> [−0.007, 0.016] </td>\n   <td style=\"text-align:center;\"> [−0.021, 0.024] </td>\n   <td style=\"text-align:center;\"> [−0.018, 0.023] </td>\n   <td style=\"text-align:center;\"> [0.0009, 0.012] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Count of natural disasters </td>\n   <td style=\"text-align:center;\"> 0.005 </td>\n   <td style=\"text-align:center;\"> 0.001 </td>\n   <td style=\"text-align:center;\"> 0.002 </td>\n   <td style=\"text-align:center;\"> 0.002 </td>\n   <td style=\"text-align:center;\"> −0.000001 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> [−0.00008, 0.010] </td>\n   <td style=\"text-align:center;\"> [−0.000006, 0.003] </td>\n   <td style=\"text-align:center;\"> [−0.001, 0.005] </td>\n   <td style=\"text-align:center;\"> [−0.0008, 0.004] </td>\n   <td style=\"text-align:center;\"> [−0.0009, 0.0009] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Intercept </td>\n   <td style=\"text-align:center;\"> 0.422 </td>\n   <td style=\"text-align:center;\"> 0.073 </td>\n   <td style=\"text-align:center;\"> 0.142 </td>\n   <td style=\"text-align:center;\"> 0.205 </td>\n   <td style=\"text-align:center;\"> 0.088 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;box-shadow: 0px 1px\">  </td>\n   <td style=\"text-align:center;box-shadow: 0px 1px\"> [0.173, 0.704] </td>\n   <td style=\"text-align:center;box-shadow: 0px 1px\"> [0.004, 0.140] </td>\n   <td style=\"text-align:center;box-shadow: 0px 1px\"> [−0.0007, 0.276] </td>\n   <td style=\"text-align:center;box-shadow: 0px 1px\"> [0.085, 0.340] </td>\n   <td style=\"text-align:center;box-shadow: 0px 1px\"> [0.025, 0.150] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Num.Obs. </td>\n   <td style=\"text-align:center;\"> 3011 </td>\n   <td style=\"text-align:center;\"> 3011 </td>\n   <td style=\"text-align:center;\"> 3011 </td>\n   <td style=\"text-align:center;\"> 3011 </td>\n   <td style=\"text-align:center;\"> 3272 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> R2 </td>\n   <td style=\"text-align:center;\"> 0.939 </td>\n   <td style=\"text-align:center;\"> 0.947 </td>\n   <td style=\"text-align:center;\"> 0.925 </td>\n   <td style=\"text-align:center;\"> 0.939 </td>\n   <td style=\"text-align:center;\"> 0.970 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> R2 Marg. </td>\n   <td style=\"text-align:center;\"> 0.939 </td>\n   <td style=\"text-align:center;\"> 0.947 </td>\n   <td style=\"text-align:center;\"> 0.925 </td>\n   <td style=\"text-align:center;\"> 0.939 </td>\n   <td style=\"text-align:center;\"> 0.944 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> LOOIC </td>\n   <td style=\"text-align:center;\"> 4003.1 </td>\n   <td style=\"text-align:center;\"> −4054.7 </td>\n   <td style=\"text-align:center;\"> 106.9 </td>\n   <td style=\"text-align:center;\"> −340.6 </td>\n   <td style=\"text-align:center;\"> −10403.3 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> LOOIC s.e. </td>\n   <td style=\"text-align:center;\"> 520.4 </td>\n   <td style=\"text-align:center;\"> 619.3 </td>\n   <td style=\"text-align:center;\"> 435.7 </td>\n   <td style=\"text-align:center;\"> 675.4 </td>\n   <td style=\"text-align:center;\"> 266.5 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> WAIC </td>\n   <td style=\"text-align:center;\"> 4004.9 </td>\n   <td style=\"text-align:center;\"> −4047.4 </td>\n   <td style=\"text-align:center;\"> 105.0 </td>\n   <td style=\"text-align:center;\"> −328.6 </td>\n   <td style=\"text-align:center;\"> −10404.5 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> RMSE </td>\n   <td style=\"text-align:center;\"> 1.32 </td>\n   <td style=\"text-align:center;\"> 0.34 </td>\n   <td style=\"text-align:center;\"> 0.66 </td>\n   <td style=\"text-align:center;\"> 0.59 </td>\n   <td style=\"text-align:center;\"> 0.33 </td>\n  </tr>\n</tbody>\n<tfoot><tr><td style=\"padding: 0; \" colspan=\"100%\">\n<sup></sup> Posterior means; 95% credible intervals in brackets</td></tr></tfoot>\n</table>\n\n`````\n:::\n:::\n\n\n\n## Outcome models\n\n### Modeling choices\n\nWe use logged ODA, leaded by one year, as our main outcome variable throughout this analysis. We toyed with different parameterizations of ODA because of its exponential-ish distribution. For instance, instead of logging the outcome, [some papers](https://marcfbellemare.com/wordpress/13323) use an $\\operatorname{arcisnh}$ transformation, but then interpretation gets tricky. It's possible to use [Poisson/negative binomial/Gamma models with dollar outcomes that are sometimes zero](https://doi.org/10.1093/pan/mps018), but these kinds of ensemble models get unwieldy. \n\nA simpler version of the Poisson-Gamma combination is to use a hurdle model, of which there are four types currently in **brms**. One of these is `hurdle_lognormal()`, which log-transforms the outcome variable automatically. It's possible to create custom families like `hurdle_gaussian()`, but this is super hard to do. I have [an implementation partially completed here](https://discourse.mc-stan.org/t/custom-gaussian-hurdle-family-not-quite-working-in-brms/21028/2), but I can't get it to actually create posterior predictions. Ugh.\n\nSo we *could* fit a hurdled lognormal model, which uses a logit model to predict 0/not 0, then uses a lognormal distribution to model the rest of the data. However, this requires specifying two different models with different data-generating processes and different treatment effects, which becomes *immensely* unwieldy when dealing with marginal structural models and IPTWs. To simplify things, we initially tried using an intercept-only model (i.e. `outcome ~ 1`) for the 0/not 0 logit model and then `outcome | weights(iptw) ~ treatment` for the rest of the data and this worked, and the posterior predictive graphs looked phenomenal. BUT conceptually this was doing weird stuff. We were essentially ignoring all the 0s and not incorporating any of the IPTWs (or even the treatment variable!) into the models. Mathematically, this felt equivalent to just doing `filter(treatment != 0)`.\n\nSo in the end, we go back to the standard workhorse of just logging the outcome.\n\n### Interpreting outcome models\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntidy(m_oda_outcome_funding) %>%\n  mutate(estimate_exp = exp(estimate)) %>% \n  filter(term == \"funding\") %>% \n  select(term, estimate, estimate_exp)\n## # A tibble: 1 × 3\n##   term    estimate estimate_exp\n##   <chr>      <dbl>        <dbl>\n## 1 funding   -0.570        0.566\n```\n:::\n\n\n\n\nBecause our outcome is logged, the coefficients (and the ultimate ATE) represents a percent change in the outcome. The *exponentiated* coefficients represent percent changes for each unit increase in X. For instance, in the funding model, $\\beta_1$ is -0.57, while $e^{\\beta_1}$ is 0.566. Like exponentiated logistic regression coefficients, everything here is centered around 1, meaning that there's a -43.4% decrease in aid for every legal barrier added. This can be also be seen as a multiplier effect. If aid is \\$50 million, it changes to $28,278,991 (50,000,000 × 0.56558).\n\nInterpreting this coefficient gets a little trickier because we used a multilevel model with population and group effects. This $\\beta_1$ here is the **average effect for a median cluster at each level of X**. [See this incredible resource for a ton more details](https://rpsychologist.com/GLMM-part1-lognormal) about different ways of piecing together population- and group-level effects in a lognormal model.\n\n### Priors for outcome models\n\nThere are a *ton* of moving parts in these outcome models. Here's the full specification for the models and all priors:\n\n$$\n\\begin{aligned}\n\\log (\\text{Aid}_{i,t}) &\\sim \\text{IPTW}_{i, t-1} \\times \\mathcal{N} (\\mu_{i, t}, \\sigma_m) & \\text{[likelihood]}\\\\\n\\mu_{i, t} &\\sim \\alpha_{\\text{country}[i]} + \\delta_{\\text{year}[k]} + \\beta\\ \\text{Law}_{i, t-1} & \\text{[marginal structural model]}\\\\\n\\alpha_j &\\sim \\mathcal{N} (\\bar{\\alpha}, \\sigma_{\\alpha}) \\text{, for } j \\text{ in } 1 .. J & \\text{[country-specific intercepts]} \\\\\n\\delta_j &\\sim \\mathcal{N} (0, \\sigma_{\\delta}) \\text{, for } j \\text{ in } 1 .. J & \\text{[year-specific intercepts]} \\\\\n\\ \\\\\n\\bar{\\alpha} &\\sim \\mathcal{N} (0, 10) & \\text{[prior population intercept]} \\\\\n\\beta &\\sim \\mathcal{N} (0, 1) & \\text{[prior population effects]} \\\\\n\\sigma_m, \\sigma_{\\alpha}, \\sigma_{\\delta} &\\sim \\operatorname{Cauchy}(0, 1) & \\text{[prior sd for errors]}\n\\end{aligned}\n$$\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npri_int <- ggplot() +\n  stat_function(fun = ~ dnorm(.x, mean = 0, sd = 10),\n                geom = \"area\", fill = \"grey80\", color = \"black\") +\n  labs(x = TeX(r'($\\textbf{Intercept}\\ (β_0)$)')) +\n  annotate(geom = \"label\", x = 0, y = 0.004, label = \"N(0, 10)\", size = pts(9)) +\n  xlim(-40, 40) +\n  theme_donors(prior = TRUE)\n\npri_coef <- ggplot() +\n  stat_function(fun = ~ dnorm(.x, mean = 0, sd = 1),\n                geom = \"area\", fill = \"grey80\", color = \"black\") +\n  labs(x = TeX(r'($\\textbf{Coefficients}\\ (β_x)$)')) +\n  annotate(geom = \"label\", x = 0, y = 0.04, label = \"N(0, 1)\", size = pts(9)) +\n  xlim(-5, 5) +\n  theme_donors(prior = TRUE)\n\npri_sigma <- ggplot() +\n  stat_function(fun = ~ dcauchy(.x, location = 0, scale = 1),\n                geom = \"area\", fill = \"grey80\", color = \"black\") +\n  labs(x = TeX(r'($\\textbf{Errors}\\ (σ)$)')) +\n  annotate(geom = \"label\", x = 5, y = 0.033, label = \"Cauchy(0, 1)\", size = pts(9)) +\n  xlim(0, 10) +\n  theme_donors(prior = TRUE)\n\npri_cor <- tibble(prior = \"lkjcorr(6)\") %>%\n  parse_dist(prior) %>%\n  marginalize_lkjcorr(K = 3) %>% \n  ggplot(aes(y = 0, dist = .dist, args = .args)) +\n  stat_slab(color = \"black\", fill = \"grey80\", size = 0.5) +\n  geom_hline(yintercept = 0, color = \"black\", size = 0.5) +\n  labs(x = TeX(r'($\\textbf{Random\\ effects\\ correlation}\\ (r)$)')) +\n  annotate(geom = \"label\", x = 0, y = 0.1, label = \"LKJ(6)\", size = pts(9)) +\n  xlim(-1, 1) +\n  theme_donors(prior = TRUE)\n## Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\n## ℹ Please use `linewidth` instead.\n\n(pri_int + pri_coef) / (pri_sigma | pri_cor)\n```\n\n::: {.cell-output-display}\n![](models_total-aid_files/figure-html/plot-outcome-priors-1.png){fig-align='center' width=85%}\n:::\n:::\n\n\n### Check outcome models\n\nThe traceplots all look good. Here's one:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nm_oda_outcome_total %>%\n  posterior::as_draws_array() %>%\n  mcmc_trace(pars = vars(-starts_with(\"r_gwcode\"), -starts_with(\"z_\"),\n                         -starts_with(\"r_\"), -starts_with(\"bQ\"), \n                         -starts_with(\"L_\"),  -starts_with(\"Cor_1\"), -lp__)) +\n  theme_donors() +\n  theme(legend.position = \"right\")\n```\n\n::: {.cell-output-display}\n![](models_total-aid_files/figure-html/h1-check-outcome-1.png){fig-align='center' width=85%}\n:::\n:::\n\n\n### Results {.tabset}\n\n#### ATE plots\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ncoefs_nice <- tribble(\n  ~`.variable`, ~var_nice,\n  \"b_barriers_total\", \"Additional law, t - 1\",\n  \"b_advocacy\", \"Additional advocacy law, t - 1\",\n  \"b_entry\", \"Additional entry law, t - 1\",\n  \"b_funding\", \"Additional funding law, t - 1\",\n  \"b_v2xcs_ccsi\", \"Core civil society index, t - 1\"\n) %>% \n  mutate(var_nice = fct_inorder(var_nice))\n\nplot_total_data <- gather_draws(m_oda_outcome_total, b_barriers_total)\nplot_advocacy_data <- gather_draws(m_oda_outcome_advocacy, b_advocacy)\nplot_entry_data <- gather_draws(m_oda_outcome_entry, b_entry)\nplot_funding_data <- gather_draws(m_oda_outcome_funding, b_funding) \n\nplot_total_aid_coefs <- bind_rows(plot_total_data, plot_advocacy_data,\n                                  plot_entry_data, plot_funding_data) %>% \n  left_join(coefs_nice, by = \".variable\")\n\nwithin_country_aid <- df_oda_iptw_total %>% \n  filter(total_oda != 0) %>% \n  group_by(country) %>% \n  mutate(aid_mean = mean(total_oda, na.rm = TRUE),\n         aid_demean = total_oda - aid_mean) %>% \n  ungroup() %>% \n  mutate(aid_demean_log = log1p(abs(aid_demean)))\n\n# rope_sd <- sd(df_oda_iptw_total$total_oda_log_lead1)\nrope_sd <- sd(within_country_aid$aid_demean_log)\n\nplot_rope <- tibble(xmin = -0.05 * rope_sd, \n                    xmax = 0.05 * rope_sd)\n\nggplot(plot_total_aid_coefs, aes(x = .value, y = fct_rev(var_nice), fill = var_nice)) +\n  geom_vline(xintercept = 0) +\n  geom_rect(data = plot_rope, aes(xmin = xmin, xmax = xmax, ymin = -Inf, ymax = Inf),\n            fill = \"#FFDC00\", alpha = 0.3, inherit.aes = FALSE) +\n  annotate(geom = \"label\", x = 0, y = 0.65, \n           label = \"Region of practical equivalence\\n(± 0.05 × SD log foreign aid)\",\n           size = pts(8)) +\n  stat_halfeye(.width = c(0.8, 0.95), alpha = 0.8, point_interval = \"median_hdi\") +\n  guides(fill = \"none\") +\n  scale_y_discrete() +\n  scale_fill_manual(values = c(\"#FF851B\", \"#85144b\", \"#3D9970\", \"#001f3f\")) +\n  labs(x = \"Change in log foreign aid in following year\", y = NULL,\n       caption = \"Point shows posterior median;\\nlines show 80% and 95% credible highest-density-interval\") +\n  theme_donors()\n## Warning: Using the `size` aesthietic with geom_segment was deprecated in ggplot2 3.4.0.\n## ℹ Please use the `linewidth` aesthetic instead.\n```\n\n::: {.cell-output-display}\n![](models_total-aid_files/figure-html/h1-plots-dejure-1.png){fig-align='center' width=85%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nplot_ccsi_coefs <- m_oda_outcome_ccsi %>% \n  map_dfr(~gather_draws(., b_v2xcs_ccsi), .id = \"model\") %>% \n  mutate(.value = .value / 10) %>% \n  mutate(model = comma(as.numeric(str_remove(model, \"model_\")))) %>% \n  mutate(model = fct_inorder(model)) %>% \n  left_join(coefs_nice, by = \".variable\")\n\nggplot(plot_ccsi_coefs, aes(x = .value, y = fct_rev(model), fill = model)) +\n  geom_vline(xintercept = 0) +\n  geom_rect(data = plot_rope, aes(xmin = xmin, xmax = xmax, ymin = -Inf, ymax = Inf),\n            fill = \"#FFDC00\", alpha = 0.3, inherit.aes = FALSE) +\n  annotate(geom = \"label\", x = 0, y = 0.65,\n           label = \"Region of practical equivalence\\n(± 0.05 × SD log foreign aid)\",\n           size = pts(8)) +\n  stat_halfeye(.width = c(0.8, 0.95), point_interval = \"median_hdi\",\n               position = position_dodge(width = 0.5)) +\n  guides(fill = \"none\") +\n  scale_y_discrete() +\n  labs(x = \"Coefficient\", y = \"IPTW truncation point\") +\n  theme_donors()\n```\n\n::: {.cell-output-display}\n![](models_total-aid_files/figure-html/h1-plots-defacto-1.png){fig-align='center' width=85%}\n:::\n:::\n\n\n#### Tables\n\n\n::: {#tbl-h1-dejure .cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# model_names <- paste0(\"(\", 1:length(models_tbl_h1_outcome_dejure), \")\")\nmodel_names <- 1:length(models_tbl_h1_outcome_dejure)\nnames(models_tbl_h1_outcome_dejure) <- model_names\n\ntreatment_names <- c(\"Treatment\", \"Total barriers (t)\", \"Barriers to advocacy (t)\", \n                     \"Barriers to entry (t)\", \"Barriers to funding (t)\")\ntreatment_rows <- as.data.frame(t(treatment_names))\nattr(treatment_rows, \"position\") <- 1\n\ncoef_list_outcome <- list(\n  \"b_barriers_total\" = \"Treatment (t)\",\n  \"b_advocacy\" = \"Treatment (t)\",\n  \"b_entry\" = \"Treatment (t)\",\n  \"b_funding\" = \"Treatment (t)\",\n  \"b_v2xcs_ccsi\" = \"Core civil society index (t)\",\n  \"b_Intercept\" = \"Intercept\",\n  \"sd_gwcode__Intercept\" = \"σ country intercepts\",\n  \"sd_year__Intercept\" = \"σ year intercepts\"\n)\n\nmodelsummary(models_tbl_h1_outcome_dejure,\n             statistic = \"[{conf.low}, {conf.high}]\",\n             coef_map = coef_list_outcome,\n             add_rows = treatment_rows,\n             gof_omit = \"ELPD\",\n             escape = FALSE,\n             notes = list(\"Posterior means; 95% credible intervals in brackets\")) %>% \n  add_header_above(c(\" \" = 1, \"Outcome: ODA (t + 1)\" = 4))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table style=\"NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto;\" class=\"table\">\n <thead>\n<tr>\n<th style=\"empty-cells: hide;border-bottom:hidden;\" colspan=\"1\"></th>\n<th style=\"border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; \" colspan=\"4\"><div style=\"border-bottom: 1px solid #ddd; padding-bottom: 5px; \">Outcome: ODA (t + 1)</div></th>\n</tr>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:center;\"> 1 </th>\n   <th style=\"text-align:center;\"> 2 </th>\n   <th style=\"text-align:center;\"> 3 </th>\n   <th style=\"text-align:center;\"> 4 </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Treatment </td>\n   <td style=\"text-align:center;\"> Total barriers (t) </td>\n   <td style=\"text-align:center;\"> Barriers to advocacy (t) </td>\n   <td style=\"text-align:center;\"> Barriers to entry (t) </td>\n   <td style=\"text-align:center;\"> Barriers to funding (t) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Treatment (t) </td>\n   <td style=\"text-align:center;\"> −0.220 </td>\n   <td style=\"text-align:center;\"> −0.450 </td>\n   <td style=\"text-align:center;\"> −0.233 </td>\n   <td style=\"text-align:center;\"> −0.570 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> [−0.351, −0.098] </td>\n   <td style=\"text-align:center;\"> [−0.973, 0.042] </td>\n   <td style=\"text-align:center;\"> [−0.473, −0.0001] </td>\n   <td style=\"text-align:center;\"> [−0.845, −0.282] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Intercept </td>\n   <td style=\"text-align:center;\"> 19.741 </td>\n   <td style=\"text-align:center;\"> 19.763 </td>\n   <td style=\"text-align:center;\"> 19.781 </td>\n   <td style=\"text-align:center;\"> 19.765 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> [19.082, 20.385] </td>\n   <td style=\"text-align:center;\"> [19.101, 20.433] </td>\n   <td style=\"text-align:center;\"> [19.130, 20.432] </td>\n   <td style=\"text-align:center;\"> [19.131, 20.423] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> σ country intercepts </td>\n   <td style=\"text-align:center;\"> 3.766 </td>\n   <td style=\"text-align:center;\"> 3.812 </td>\n   <td style=\"text-align:center;\"> 3.777 </td>\n   <td style=\"text-align:center;\"> 3.784 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;box-shadow: 0px 1px\">  </td>\n   <td style=\"text-align:center;box-shadow: 0px 1px\"> [3.303, 4.249] </td>\n   <td style=\"text-align:center;box-shadow: 0px 1px\"> [3.360, 4.314] </td>\n   <td style=\"text-align:center;box-shadow: 0px 1px\"> [3.316, 4.265] </td>\n   <td style=\"text-align:center;box-shadow: 0px 1px\"> [3.322, 4.264] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Num.Obs. </td>\n   <td style=\"text-align:center;\"> 3151 </td>\n   <td style=\"text-align:center;\"> 3151 </td>\n   <td style=\"text-align:center;\"> 3151 </td>\n   <td style=\"text-align:center;\"> 3151 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> R2 </td>\n   <td style=\"text-align:center;\"> 0.758 </td>\n   <td style=\"text-align:center;\"> 0.768 </td>\n   <td style=\"text-align:center;\"> 0.756 </td>\n   <td style=\"text-align:center;\"> 0.760 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> R2 Marg. </td>\n   <td style=\"text-align:center;\"> 0.081 </td>\n   <td style=\"text-align:center;\"> 0.121 </td>\n   <td style=\"text-align:center;\"> 0.032 </td>\n   <td style=\"text-align:center;\"> 0.110 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> LOOIC </td>\n   <td style=\"text-align:center;\"> 15282.4 </td>\n   <td style=\"text-align:center;\"> 15033.6 </td>\n   <td style=\"text-align:center;\"> 14729.1 </td>\n   <td style=\"text-align:center;\"> 15595.4 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> LOOIC s.e. </td>\n   <td style=\"text-align:center;\"> 301.8 </td>\n   <td style=\"text-align:center;\"> 267.5 </td>\n   <td style=\"text-align:center;\"> 263.3 </td>\n   <td style=\"text-align:center;\"> 314.2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> WAIC </td>\n   <td style=\"text-align:center;\"> 15275.6 </td>\n   <td style=\"text-align:center;\"> 15027.7 </td>\n   <td style=\"text-align:center;\"> 14725.8 </td>\n   <td style=\"text-align:center;\"> 15593.4 </td>\n  </tr>\n</tbody>\n<tfoot><tr><td style=\"padding: 0; \" colspan=\"100%\">\n<sup></sup> Posterior means; 95% credible intervals in brackets</td></tr></tfoot>\n</table>\n\n`````\n:::\n:::\n\n::: {#tbl-h1-defacto .cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntruncation_thresholds <- names(models_tbl_h1_outcome_defacto) %>% \n  str_extract(\"_\\\\d+\") %>% \n  str_remove(\"_\") %>% \n  as.numeric() %>% \n  comma()\n\ntruncation_names <- c(\"IPTW truncation threshold\", truncation_thresholds)\ntruncation_rows <- as.data.frame(t(truncation_names))\nattr(truncation_rows, \"position\") <- 1\n\n# model_names <- paste0(\"(\", 1:length(models_tbl_h1_outcome_defacto), \")\")\nmodel_names <- 1:length(models_tbl_h1_outcome_defacto)\nnames(models_tbl_h1_outcome_defacto) <- model_names\n\nmodelsummary(models_tbl_h1_outcome_defacto,\n             statistic = \"[{conf.low}, {conf.high}]\",\n             coef_map = coef_list_outcome,\n             add_rows = truncation_rows,\n             gof_omit = \"ELPD\",\n             escape = FALSE,\n             notes = list(\"Posterior means; 95% credible intervals in brackets\")) %>% \n  add_header_above(c(\" \" = 1, \"Outcome: ODA (t + 1)\" = 4))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table style=\"NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto;\" class=\"table\">\n <thead>\n<tr>\n<th style=\"empty-cells: hide;border-bottom:hidden;\" colspan=\"1\"></th>\n<th style=\"border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; \" colspan=\"4\"><div style=\"border-bottom: 1px solid #ddd; padding-bottom: 5px; \">Outcome: ODA (t + 1)</div></th>\n</tr>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:center;\"> 1 </th>\n   <th style=\"text-align:center;\"> 2 </th>\n   <th style=\"text-align:center;\"> 3 </th>\n   <th style=\"text-align:center;\"> 4 </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> IPTW truncation threshold </td>\n   <td style=\"text-align:center;\"> 100 </td>\n   <td style=\"text-align:center;\"> 500 </td>\n   <td style=\"text-align:center;\"> 1,000 </td>\n   <td style=\"text-align:center;\"> 5,000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Core civil society index (t) </td>\n   <td style=\"text-align:center;\"> 3.445 </td>\n   <td style=\"text-align:center;\"> 2.897 </td>\n   <td style=\"text-align:center;\"> 3.185 </td>\n   <td style=\"text-align:center;\"> 5.344 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> [3.178, 3.733] </td>\n   <td style=\"text-align:center;\"> [2.736, 3.063] </td>\n   <td style=\"text-align:center;\"> [3.058, 3.314] </td>\n   <td style=\"text-align:center;\"> [5.249, 5.438] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Intercept </td>\n   <td style=\"text-align:center;\"> 18.796 </td>\n   <td style=\"text-align:center;\"> 18.710 </td>\n   <td style=\"text-align:center;\"> 18.234 </td>\n   <td style=\"text-align:center;\"> 15.342 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> [17.983, 19.619] </td>\n   <td style=\"text-align:center;\"> [17.909, 19.447] </td>\n   <td style=\"text-align:center;\"> [17.551, 18.909] </td>\n   <td style=\"text-align:center;\"> [14.576, 16.059] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> σ country intercepts </td>\n   <td style=\"text-align:center;\"> 4.404 </td>\n   <td style=\"text-align:center;\"> 4.077 </td>\n   <td style=\"text-align:center;\"> 3.814 </td>\n   <td style=\"text-align:center;\"> 4.063 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;box-shadow: 0px 1px\">  </td>\n   <td style=\"text-align:center;box-shadow: 0px 1px\"> [3.833, 5.048] </td>\n   <td style=\"text-align:center;box-shadow: 0px 1px\"> [3.559, 4.656] </td>\n   <td style=\"text-align:center;box-shadow: 0px 1px\"> [3.316, 4.352] </td>\n   <td style=\"text-align:center;box-shadow: 0px 1px\"> [3.562, 4.628] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Num.Obs. </td>\n   <td style=\"text-align:center;\"> 3156 </td>\n   <td style=\"text-align:center;\"> 3156 </td>\n   <td style=\"text-align:center;\"> 3156 </td>\n   <td style=\"text-align:center;\"> 3156 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> R2 </td>\n   <td style=\"text-align:center;\"> 0.593 </td>\n   <td style=\"text-align:center;\"> 0.590 </td>\n   <td style=\"text-align:center;\"> 0.586 </td>\n   <td style=\"text-align:center;\"> 0.577 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> R2 Marg. </td>\n   <td style=\"text-align:center;\"> 0.243 </td>\n   <td style=\"text-align:center;\"> 0.172 </td>\n   <td style=\"text-align:center;\"> 0.094 </td>\n   <td style=\"text-align:center;\"> 0.305 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> LOOIC </td>\n   <td style=\"text-align:center;\"> 81267.5 </td>\n   <td style=\"text-align:center;\"> 274084.7 </td>\n   <td style=\"text-align:center;\"> 479605.8 </td>\n   <td style=\"text-align:center;\"> 1745367.1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> LOOIC s.e. </td>\n   <td style=\"text-align:center;\"> 9962.1 </td>\n   <td style=\"text-align:center;\"> 46129.8 </td>\n   <td style=\"text-align:center;\"> 85564.5 </td>\n   <td style=\"text-align:center;\"> 322324.2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> WAIC </td>\n   <td style=\"text-align:center;\"> 87607.6 </td>\n   <td style=\"text-align:center;\"> 315234.0 </td>\n   <td style=\"text-align:center;\"> 563418.4 </td>\n   <td style=\"text-align:center;\"> 2085046.2 </td>\n  </tr>\n</tbody>\n<tfoot><tr><td style=\"padding: 0; \" colspan=\"100%\">\n<sup></sup> Posterior means; 95% credible intervals in brackets</td></tr></tfoot>\n</table>\n\n`````\n:::\n:::\n\n\n#### Marginal effects\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# brms::conditional_effects() can create spaghetti plots (single lines per\n# sample), but it stores them in an attribute slot named \"spaghetti\", which is\n# tricky to extract data from. This pulls the data frame from the attribute\nmake_spaghetti <- function(model) {\n  raw_effects <- conditional_effects(model, spaghetti = TRUE, ndraws = 100)[[1]]\n  spaghetti_data <- attr(raw_effects, \"spaghetti\")\n  return(spaghetti_data)\n}\n\nmake_spaghetti(m_oda_outcome_total) %>% \n  mutate(estimate__ = exp(estimate__)) %>% \n  ggplot(aes(x = effect1__, y = estimate__, group = sample__)) +\n  geom_line(size = 0.25, color = \"#FF4136\") +\n  scale_x_continuous(breaks = 0:9) +\n  scale_y_continuous(labels = dollar, trans = pseudo_log_trans()) +\n  guides(color = \"none\") +\n  labs(x = \"Count of total legal barriers\",\n       y = \"Predicted total ODA in following year\") +\n  theme_donors() +\n  theme(panel.grid.major.x = element_blank())\n```\n\n::: {.cell-output-display}\n![](models_total-aid_files/figure-html/h1-conditional-effects-1.png){fig-align='center' width=85%}\n:::\n\n```{.r .cell-code}\n\nmake_spaghetti(m_oda_outcome_advocacy) %>% \n  mutate(estimate__ = exp(estimate__)) %>%\n  ggplot(aes(x = effect1__, y = estimate__, group = sample__)) +\n  geom_line(size = 0.25, color = \"#FF4136\") +\n  scale_x_continuous(breaks = 0:2) +\n  scale_y_continuous(labels = dollar, trans = pseudo_log_trans()) +\n  guides(color = \"none\") +\n  labs(x = \"Count of barriers to advocacy\",\n       y = \"Predicted total ODA in following year\") +\n  theme_donors() +\n  theme(panel.grid.major.x = element_blank())\n```\n\n::: {.cell-output-display}\n![](models_total-aid_files/figure-html/h1-conditional-effects-2.png){fig-align='center' width=85%}\n:::\n\n```{.r .cell-code}\n\nmake_spaghetti(m_oda_outcome_entry) %>% \n  mutate(estimate__ = exp(estimate__)) %>% \n  ggplot(aes(x = effect1__, y = estimate__, group = sample__)) +\n  geom_line(size = 0.25, color = \"#FF4136\") +\n  scale_x_continuous(breaks = 0:3) +\n  scale_y_continuous(labels = dollar, trans = pseudo_log_trans()) +\n  guides(color = \"none\") +\n  labs(x = \"Count of barriers to entry\",\n       y = \"Predicted total ODA in following year\") +\n  theme_donors() +\n  theme(panel.grid.major.x = element_blank())\n```\n\n::: {.cell-output-display}\n![](models_total-aid_files/figure-html/h1-conditional-effects-3.png){fig-align='center' width=85%}\n:::\n\n```{.r .cell-code}\n\nmake_spaghetti(m_oda_outcome_funding) %>% \n  mutate(estimate__ = exp(estimate__)) %>% \n  ggplot(aes(x = effect1__, y = estimate__, group = sample__)) +\n  geom_line(size = 0.25, color = \"#FF4136\") +\n  scale_x_continuous(breaks = 0:5) +\n  scale_y_continuous(labels = dollar, trans = pseudo_log_trans()) +\n  guides(color = \"none\") +\n  labs(x = \"Count of barriers to funding\",\n       y = \"Predicted total ODA in following year\") +\n  theme_donors() +\n  theme(panel.grid.major.x = element_blank())\n```\n\n::: {.cell-output-display}\n![](models_total-aid_files/figure-html/h1-conditional-effects-4.png){fig-align='center' width=85%}\n:::\n:::\n",
    "supporting": [
      "models_total-aid_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
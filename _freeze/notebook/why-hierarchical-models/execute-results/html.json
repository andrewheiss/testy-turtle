{
  "hash": "fabfa85b2ffd99627d39bc2522768bdf",
  "result": {
    "markdown": "---\ntitle: \"Why hierarchical models?\"\n---\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(targets)\nlibrary(scales)\nlibrary(patchwork)\n\nfont_opts <- list(extra.preamble = c(\"\\\\usepackage{libertine}\", \n                                     \"\\\\usepackage{libertinust1math}\"),\n                  dvisvgm.opts = \"--font-format=woff\")\n\n# Load data \n# Plotting functions\ninvisible(list2env(tar_read(graphic_functions), .GlobalEnv))\ninvisible(list2env(tar_read(misc_funs), .GlobalEnv))\n\ndf_country_aid <- tar_read(country_aid_final)\ndf_country_aid_laws <- filter(df_country_aid, laws)\n```\n:::\n\n\n\n# Hierarchical structure\n\n\n\n\n\nOur data includes information about 142 countries across 24 years (from 1990–2013). This kind of time series cross-sectional (TSCS) data reflects a natural hierarchical structure, with repeated yearly observations nested within countries ([see this whole guide I wrote](https://www.andrewheiss.com/blog/2021/12/01/multilevel-models-panel-data-guide/) because of this exact project)\n\n\n::: {.cell layout-align=\"center\" engine.opts='{\"extra.preamble\":[\"\\\\usepackage{libertine}\",\"\\\\usepackage{libertinust1math}\"],\"dvisvgm.opts\":\"--font-format=woff\"}'}\n::: {.cell-output-display}\n![Multilevel panel data structure, with yearly observations of $y$ nested in countries](why-hierarchical-models_files/figure-html/panel-structure-1.svg){fig-align='center' width=100%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nbiggest_movers <- df_country_aid_laws %>% \n  group_by(country) %>% \n  filter(!any(total_oda == 0)) %>% \n  summarize(across(c(v2csreprss, total_oda), lst(min, max, diff = ~max(.) - min(.))))\n\ntop_overall <- top_n(biggest_movers, 15, v2csreprss_diff) %>% \n  filter(country %in% top_n(biggest_movers, 15, total_oda_diff)$country) %>% \n  top_n(3, v2csreprss_diff)\n\ndf_cs_oda_highlight <- df_country_aid_laws %>% \n  mutate(highlight_country = ifelse(country %in% top_overall$country, \n                                    country, \"Other\"),\n         highlight_country = factor(highlight_country, ordered = TRUE),\n         highlight_country = fct_relevel(highlight_country, \"Other\", after = Inf)) %>% \n  mutate(highlight = highlight_country != \"Other\")\n\nggplot(df_cs_oda_highlight, aes(x = v2csreprss, y = total_oda, group = country)) +\n  geom_point(size = 0.15, alpha = 0.15) +\n  geom_smooth(method = \"lm\", aes(group = NULL), color = clrs$Prism[6], \n              linewidth = 1.25, linetype = \"21\", se = FALSE, formula = y ~ x) +\n  geom_path(aes(color = highlight_country, size = highlight),\n            arrow = arrow(type = \"open\", angle = 30, length = unit(0.75, \"lines\")),\n            key_glyph = \"timeseries\") +\n  scale_y_continuous(trans = \"log1p\", breaks = c(1e7, 1e8, 1e9, 1e10, 1e11),\n                     labels = label_dollar(scale_cut = cut_short_scale())) +\n  scale_size_manual(values = c(0.075, 1.25), guide = \"none\") +\n  scale_color_manual(values = c(clrs$Prism[2], clrs$Prism[7], clrs$Prism[9], \"grey50\"),\n                     guide = guide_legend(override.aes = list(linewidth = 1))) +\n  coord_cartesian(ylim = c(1e7, 1e11)) +\n  labs(x = \"Civil society repression\\n(Higher values represent less repression)\",\n       y = \"Total ODA\", color = NULL, size = NULL) +\n  theme_donors()\n## Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\n## ℹ Please use `linewidth` instead.\n```\n\n::: {.cell-output-display}\n![](why-hierarchical-models_files/figure-html/plot-biggest-movers-1.png){fig-align='center' width=80%}\n:::\n:::\n",
    "supporting": [
      "why-hierarchical-models_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}